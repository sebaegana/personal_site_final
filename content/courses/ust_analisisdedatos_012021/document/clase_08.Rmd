---
header-includes:
  - \usepackage[spanish]{babel}
  - \usepackage{svg}
title: |
  ![](logo_fen.jpg){width=2in}  
  ICO 187 ANÁLISIS DE DATOS
author: "Clase 08: Manipulación e integración de datos en Excel"
year: 2021
prof: "Sebastián Egaña"
# due: "Jueves 11 de Marzo"
# submit: "engin604assignments@gmail.com"
# page: "5 páginas"
# bibliography: "latex/references.bib"
# biblio-style: "acm"
link-citations: yes
citecolor: blue
urlcolor: blue
linkcolor: blue
geometry: margin=0.75in
fontsize: 10pt
output: 
  bookdown::pdf_document2:
    toc: no
    highlight: "default"
    number_sections: yes
    fig_caption: yes
    dev: cairo_pdf
    latex_engine: pdflatex
    template: "Latex/template.tex"
always_allow_html: true
nocite: '@*'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Repaso de la clase pasada: Unión de bases de datos (Joins). 

Recordar que vimos algunas formas de generar uniones entre bases de datos. Esto puede cambiar en relación a nuestra necesidad, y la finalidad de nuestro trabajo. 

Ahora intentaremos realizar un trabajo aplicado sobre el tema.

# Set de datos

Considere que se tiene un set de datos clase_08.xlsx, que contiene 4 tablas:

+ Flights: Corresponde a distintos identificadores de vuelos por ruta. 
+ Routes: Rutas de vuelos.
+ Aircraft: Tipos de aviones. 
+ Airports: Set de datos descriptor de aeropuertos en USA. 

# Import - Tidy - Transform

Se piensa que importar, solo refiere a poder obtener los datos. Desde mi punto de vista, este corresponde a un paso para poder mirar los datos y poder hacernos algunas idea de los datos. Veamos en detalle cada set de datos. 

+ ¿Cuáles son las variables de cada set de datos?

Por ejemplo, ¿qué es FuelCostperSeatMile (Cents)?

\href{https://www.investopedia.com/terms/c/casm.asp#:~:text=Cost%20per%20available%20seat%20mile%20(CASM)%20is%20a%20common%20unit,profitable%20and%20efficient%20the%20airline.}{Acá}

Pero una pregunta más general es, ¿por qué es relevante aprender estos conceptos?

+ ¿Se observa algún error en los datos?

Fijemonos en el formato de la fecha.

+ ¿Posee la estructura correcta el set de datos?

No se ven errores; en las filas están las observaciones y en las columnas las variables. No existen formatos, ni celdas combinadas. 

+ ¿Existe identificadores únicos en los set de datos?

Existen múltiples identificadores únicos. 

Se debe intentar llegar al análisis relevante del set de datos. En el caso de este set datos, claramente se puede llegar a un set de datos más completo uniendolo con los otros. Sobre lo mismo:

+ ¿Cúal es el set de datos que debe mantenerse? Veamos alguna manera de llegar a dicha conclusión. 

Por último, se puede pensar en la inclusión de datos a la base de datos, que podrían ser de algún interés. En este caso intentaremos agregar los siguientes datos:

\href{https://en.wikipedia.org/wiki/List_of_airports_in_the_United_States}{Acá}

Hasta este punto, aún no hemos terminado con dicha procedimiento de **batallar con los datos**. 

Antes de aplicar la unión de datos, sería bueno poder diagramar la relación que existe entre cada base datos. Acá debemos abordar un contenido relacionado.

# Modelo de datos

Corresponde a una serie de conceptos que pueden utilizarse para describir un conjunto de datos y las operaciones relacionadas para su manipulación. 

En la actualidad el modelo de bases de datos más utilizado corresponde al modelo relacional, que se define como el intento de obtener datos de distintas fuentes a través de relaciones o consultas para la obtención de datos. Esto quiere decir, que no necesariamente se tiene una **base gigante**, sino que se tiene la opción de acceder a bases pequeñas que pueden ir complementando los análisis. 

 
## Modelo Relacional

Las entidades  y relaciones se representan en formas de tablas.

+ Las tablas son las relaciones.
+ Las filas (tuplas) contienen datos sobre cada entidad.
+ Las columnas corresponden a atributos de las entidades. 

Se pretende determinar operaciones a realizar: Unión, intersección, diferencia, producto cartesiano, selección, proyección, reunión, etc. 

Por otra parte, existen restricciones de integridad de entidad como también de integridad referencial (relacionado con el tema de llaves que vimos anteriormente).

Por ejemplo: 

\begin{center}
\begin{tabular}{|c|c|c|}
	\hline
	Entidades & Proveedor & Pieza \\
	\hline
	Atributos & Código & Código \\
	\hline
	& Nombre & Nombre  \\
	\hline
	& Ciudad & Dimensiones \\
	& & Peso \\
	\hline
\end{tabular}
\end{center}

En donde:

\begin{center}
\begin{tabular}{|c|c|}
	\hline
	Relación & Suministra \\
	\hline
	Entidades Participantes & Proveedor - Pieza \\
	\hline
	Cardinalidad & Muchos a muchos  \\
	\hline
	Atributos & Cantidad \\
	\hline
\end{tabular}
\end{center}

De manera más especifica, el modelo entidad/relación corresponde a la técnica basada en la identificación de las entidades y de las relaciones que se dan entre ellas, según la realidad que se intenta modelar. 

Se debe recordar acá, el concepto de llave del que hablamos la clase pasada. Una llave (o también llamada clave), corresponde a un conjunto de atributos que permite identificar unívocamente a una entidad dentro de un conjunto de entidades. 

Por ejemplo para una Facultad el modelo podría ser:

\begin{center}
\begin{tabular}{|c|c|c|c|c|c|c|}
	\hline
	Entidades & Asignatura & Alumno & Profesor & Departamento & Aula & Grupo \\
	Atributos & ID & RUT & RUT & ID & ID & ID \\
	& Nombre & Nombre & Nombre & Nombre & Capacidad & Tipo  \\
	& Créditos & Dirección & Categoría & & & \\
	& Curso & Email & Email & & & \\
	\hline
\end{tabular}
\end{center}

En donde existen las siguientes relaciones:

\begin{center}
\begin{tabular}{|c|c|c|c|c|c|c|}
	\hline
	Relación & Entidades participantes & Cardinalidad & Atributos \\
	se matricula en & Alumno - Grupo & N:M & Calificación \\
	enseña & Profesor - Grupo & N:M & \\
	impartida en & Asignatura - Grupo & 1:N  &\\
	asignada a & Aula - Grupo & N:M & Día, hora \\
	pertenece a & Profesor - Departamento & N:1 & \\
	dirige & Profesor - Departamento & 1:1 & \\
	\hline
\end{tabular}
\end{center}

Esto también puede ser representado de manera grafica. Veamos el siguiente ejemplo:

```{r, message = FALSE, warning=FALSE}
library(datamodelr)
file_path <- system.file("samples/example.yml", package = "datamodelr")
dm <- dm_read_yaml(file_path)

graph <- dm_create_graph(dm, rankdir = "BT")

dm_render_graph(graph)

```

Veamos esto en relación a los datos que estuvimos revisando; primero debemos ingresar las tablas sobre las que estuvimos trabajando. 

```{r, message = FALSE, warning=FALSE}
library(readxl)

flights_01 <- read_excel("G:/My Drive/Docencia 2020 - 2021/UST - 2021 01 Análisis de Datos/excel/clase_08.xlsx",
              sheet = "Flights")

routes_01 <- read_excel("G:/My Drive/Docencia 2020 - 2021/UST - 2021 01 Análisis de Datos/excel/clase_08.xlsx",
                         sheet = "Routes")

airports_01 <- read_excel("G:/My Drive/Docencia 2020 - 2021/UST - 2021 01 Análisis de Datos/excel/clase_08.xlsx",
                         sheet = "Airports")

aircraft_01 <- read_excel("G:/My Drive/Docencia 2020 - 2021/UST - 2021 01 Análisis de Datos/excel/clase_08.xlsx",
                         sheet = "Aircraft")


dm_f <- dm_from_data_frames(flights_01, routes_01, aircraft_01, airports_01)
graph <- dm_create_graph(dm_f, rankdir = "BT", col_attr = c("column", "type"))
dm_render_graph(graph)


```

Después debemos generar las relaciones entre cada una de las tablas:

```{r, message = FALSE, warning=FALSE}
dm_f <- dm_add_references(
  dm_f,
  
  aircraft_01$AircraftID == flights_01$AircraftID,
  airports_01$AirportID == routes_01$AirportID,
  flights_01$RouteID == routes_01$RouteID
)
graph <- dm_create_graph(dm_f, rankdir = "BT", col_attr = c("column", "type"))
dm_render_graph(graph)

```

Podemos intentar mejorar un poco el formato de la visualización:

```{r}

graph <- dm_create_graph( 
  dm_f, 
  graph_attrs = "rankdir = RL, bgcolor = '#F4F0EF' ", 
  edge_attrs = "dir = both, arrowtail = crow, arrowhead = odiamond",
  node_attrs = "fontname = 'Arial'")

dm_render_graph(graph)


```



# Avisos

+ Fue subida la Guía en Grupo N01. Recordar que deben enviar el set de datos para su aprobación y los integrantes del grupo hasta el final de la semana (3 o 4 integrantes, sin excepciones)

+ Se actualizo el punto 5 de las instrucciones. 

# Fechas Relevantes

\begin{center}
\begin{tabular}{|c|l|c|c|}
	\hline
	Unidad & Evaluación & Ponderación & Fecha \\
	\hline
	Unidad I & Evaluación diagnóstica & & 25/03/2021 \\
	\hline
	& Evaluación Individual Participación & (5\%) & 05/04/2021 \\
	\hline
	& Evaluación Grupal & (15\%) & 27/04/2021 - 04/05/2021 \\
	\hline
	& Evaluación Individual - Sumativa I & (30\%) & 11/05/2021 \\
	\hline
	Unidad II & Evaluación Formativa & & 13/05/2021 \\
	\hline
	& Evaluación Individual Participación & (5\%) & 27/05/2021 \\
	\hline
	& Evaluación Grupal & (10\%) & 08/06/2021 - 15/06/2021 \\
	\hline
	& Evaluación Individual - Sumativa II & (15\%) & 17/06/2021 \\
	\hline
	Unidad III & Evaluación Formativa & & 22/06/2021 \\
	\hline
	& Evaluación Individual Participación & (5\%) & 24/06/2021 \\
	\hline
	& Evaluación Individual Sesión I- Sumativa III & (15\%) & 08/07/2021 \\
	\hline
	& Evaluación Individual Sesión II- Sumativa III & (15\%) & 13/07/2021 \\
	\hline
\end{tabular}
\end{center}

