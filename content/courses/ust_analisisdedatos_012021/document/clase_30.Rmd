---
header-includes:
  - \usepackage[spanish]{babel}
  - \usepackage{svg}
  - \usepackage[normalem]{ulem}
  - \usepackage{attachfile}
title: |
  ![](logo_fen.jpg){width=2in}  
  ICO 187 ANÁLISIS DE DATOS
author: "Clase 30: Integración Power Bi y R"
year: 2021
prof: "Sebastián Egaña"
# due: "Jueves 11 de Marzo"
# submit: "engin604assignments@gmail.com"
# page: "5 páginas"
# bibliography: "latex/references.bib"
# biblio-style: "acm"
link-citations: yes
citecolor: blue
urlcolor: blue
linkcolor: blue
geometry: margin=0.75in
fontsize: 10pt
output: 
  bookdown::pdf_document2:
    toc: no
    highlight: "default"
    number_sections: yes
    fig_caption: yes
    dev: cairo_pdf
    latex_engine: pdflatex
    template: "Latex/template.tex"
always_allow_html: true
nocite: '@*'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, tinytex.verbose = TRUE)

library(readxl)
library(tidyverse)
library(ggplot2)


data <- read_excel("clase_27.xlsx")

data <- mutate(data, fecha_nacimiento_2 = as.POSIXct(fecha_nacimiento, format = "%d-%m-%Y"))

```

# Integración entre Power Bi y R. 

La finalidad de esta clase es lograr aplicar alguna de las funcionalidades de R y RStudio, e intentar integrarlas con el entorno en Power Bi. Esto solo es aplicable si se tiene instalado Power Bi en el computador (desktop), lo que aplica también para R. Considerar que Power Bi utiliza la instalación de R cuando se realiza dicha labor. 

Replicaremos los gráficos de la última clase en Power Bi, utilizando R. 

# Graficar usanto el set de datos "iris"

Dicho set de de datos, viene pre instalado en R y podemos ver su descripción con el siguiente comando:

```{r, eval=FALSE}
?iris
```

1. Primero debemos declarar el set de datos utilizado. Para esto obtenemos datos desde "Script de R" en Power Bi. Considerando la lógica de R, declaramos el set de datos a utilizar de la siguiente manera:

```{r, eval=FALSE}
data_iris <- iris
```

2. Graficamos utilizando la misma lógica de la clase pasada.

Primero, debemos generar la visualización con "Objeto visual de script de R". Nos aparece un mensaje, para seleccionar las variables a utilizar. En este caso, lo mejor es selecionarlas todas.  

Esto nos obligará a revisar un código que aparece por defecto. Veamos la siguiente declaración:

```{r, eval=FALSE}
# El código siguiente, que crea un dataframe y quita las filas duplicadas, siempre se ejecuta y actúa como un preámbulo del script: 

# dataset <- data.frame(Petal.Width, Petal.Length, Sepal.Length, Sepal.Width, Species)
# dataset <- unique(dataset)

# Pegue o escriba aquí el código de script:
```
 
Si analizamos esto, vemos que por defecto Power Bi renombra nuestro set de datos como "dataset" considerando las variables utilizadas y aplicando un filtro para filas duplicadas. 

Declararamos el set de datos haciendo las modificaciones necesarias:

```{r,eval=FALSE}
grafico_0 <- ggplot(dataset) 

grafico_0
```

Declaramos las coordenadas: 

```{r, eval=FALSE}
grafico_1 <- ggplot(dataset) + 
  aes(x = Petal.Length, y = Petal.Width, colour = Species) 
  
grafico_1
```

Por último, declaramos el gráfico final considerando el geom

```{r, eval=FALSE}
library(dplyr)
library(ggplot2)

grafico_2 <- ggplot(iris) + 
  aes(x = Petal.Length, y = Petal.Width, colour = Species) + 
  geom_point()

grafico_2

```

Considerar que cada gráfico y su programación, es independiente. En caso de querer editar nuestro código, podemos hacer un click en la flecha que nos redirige al IDE que tengamos instalado (RStudio) 

\begin{center}
\includegraphics[width=15cm, height=16cm]{image_01.PNG}
\end{center}

Si quisieramos modificar la data, debemos entrar a la transformación de datos considerando que lo haremos usando "Ejecutar script de R".

\begin{center}
\includegraphics[width=15cm, height=16cm]{r_pbi_01.PNG}
\end{center}

Generamos una columna de 1 en el set de datos proveniente de "iris":

```{r, eval=FALSE}
# 'dataset' contiene los datos de entrada para este script
library(dplyr)

ds <- dataset
ds <- mutate(ds, unos = 1)
dataset <- ds
```

# Graficar usanto el set de datos "clase_27"

1. Importamos el set de datos, considerando que en este caso proviene de una carpeta en nuestro computador. Aprovechamos de generar las variables de fecha de nacimiento con el formato correcto, como también el la variable relacionada con la edad:

```{r, eval=FALSE}
library(readxl)
library(dplyr)

data_2 <- read_excel("G:/Mi unidad/Docencia 2020 - 2021/UST - 2021 01 Análisis de Datos/document/clase_27.xlsx", sheet = "data")

# Aplicación pipe

data_2 <- data_2 %>%
  mutate(fecha_nacimiento_2 = as.POSIXct(fecha_nacimiento, format = " %d- %m- %Y"))

# Generar edad

data_2 <- data_2 %>%
  mutate(hoy = as.POSIXct("2021-07-01", format = " %Y- %m- %d"),
         edad = (hoy - fecha_nacimiento_2)/365)
```

2. Insertamos el elemento gráfico, seleccionado las variables a utilizar que por general deben ser todas:

```{r, eval=FALSE}
# El código siguiente, que crea un dataframe y quita las filas duplicadas, siempre se ejecuta y actúa como un preámbulo del script: 

# dataset <- data.frame(afectacion, edad, emergencia_n, fecha_nacimiento, Año, Trimestre, Mes, Día, fibe, Año.1, Trimestre.1, Mes.1, Día.1, parentesco, id_persona, region_c, region_n, region_rsh, sexo, tramo_cse)
# dataset <- unique(dataset)

# Pegue o escriba aquí el código de script:
```

Declaramos el gráfico terminado de la clase pasada:

```{r, eval=FALSE}
library(dplyr)
library(ggplot2)


p_2 <- ggplot(dataset) + 
  aes(y = sexo, fill = afectacion) + 
  geom_bar(position=position_dodge())

p_2
```

# Fechas Relevantes

\begin{center}
\begin{tabular}{|c|l|c|c|}
	\hline
	Unidad & Evaluación & Ponderación & Fecha \\
	\hline
	Unidad I & \sout{Evaluación diagnóstica} & & 25/03/2021 \\
	\hline
	& \sout{Evaluación Individual Participación} & (5\%) & 05/04/2021 \\
	\hline
	& \sout{Evaluación Grupal} & (15\%) & 27/04/2021 - 04/05/2021 \\
	\hline
	& \sout{Evaluación Individual - Sumativa I} & (30\%) & 11/05/2021 \\
	\hline
	Unidad II & \sout{Evaluación Grupal} & (15\%) & 20/06/2021 \\
	\hline
	& \sout{Evaluación Grupal - Sumativa II} & (15\%) & 04/07/2021 \\
	\hline
	Unidad III & Evaluación Formativa & & - \\
	\hline
	& Evaluación Grupal Sesión I- Sumativa III & (20\%) & 08/07/2021 \\
	\hline
	& Evaluación grupal Sesión II- Sumativa III & (20\%) & 13/07/2021 \\
	\hline
\end{tabular}
\end{center}

